<!DOCTYPE html>
<html lang="zh"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA解题总结</title>
    <meta charset="utf-8">
    <meta name="description" content="Ladder@RSA解题总结 1、一般情况 加密 解密 p = 1325465431q = 152317153e = 65537 方法一：">
    <meta name="author" content="p1um">
    <link rel="canonical" href="https://p1um3r.github.io/blog/rsa%E8%A7%A3%E9%A2%98%E6%80%BB%E7%BB%93/">

    <link rel="alternate" type="application/rss+xml" href="https://p1um3r.github.io/index.xml" title="p1um&#39;s blog">

    


    <meta property="og:title" content="RSA解题总结" />
<meta property="og:description" content="RSA解题总结 1、一般情况 加密 解密 p = 1325465431q = 152317153e = 65537 方法一：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://p1um3r.github.io/blog/rsa%E8%A7%A3%E9%A2%98%E6%80%BB%E7%BB%93/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-07-11T08:00:00+08:00" />
<meta property="article:modified_time" content="2023-07-11T08:00:00+08:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="RSA解题总结"/>
<meta name="twitter:description" content="RSA解题总结 1、一般情况 加密 解密 p = 1325465431q = 152317153e = 65537 方法一："/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Blogs",
      "item": "https://p1um3r.github.io/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "RSA解题总结",
      "item": "https://p1um3r.github.io/blog/rsa%E8%A7%A3%E9%A2%98%E6%80%BB%E7%BB%93/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RSA解题总结",
  "name": "RSA解题总结",
  "description": "RSA解题总结 1、一般情况 加密 解密 p = 1325465431\rq = 152317153\re = 65537 方法一：",
  "keywords": [
    "RSA"
  ],
  "articleBody": "RSA解题总结 1、一般情况 加密 解密 p = 1325465431\rq = 152317153\re = 65537 方法一：\nimport libnum n = p * q phi = (p - 1) * (q - 1) d = pow(e, -1, phi) m = pow(c, d, n) print(libnum.n2s(int(m))) 方法二：\nfrom Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_OAEP import gmpy2 import binascii phi = (p - 1) * (q - 1) d = pow(e, -1, phi) rsa_components = (n, e, int(d), p, q) arsa = RSA.construct(rsa_components) rsakey = RSA.importKey(arsa.exportKey()) rsakey = PKCS1_OAEP.new(rsakey) decrypted = rsakey.decrypt(c) print(decrypted) # 用于加密时经过填充，导致c和n长度一样的情况，此时用pow解会出现乱码 2、共模数攻击 原理 任何两个用户具有相同的模数都是不安全的，因为每个用户都可以轻松地将模数分解。\n假设用户生成了$r$个拥有共模数$N$的$RSA$素数，可以得到$r$个方程式： $$ \\begin{equation} \\begin{split} e_1d_1 =\u0026 1 + k_1\\lambda(N)\\newline \u0026\\vdots\\newline e_rd_r =\u0026 1 + k_r\\lambda(N) \\end{split} \\end{equation} $$ 其中 $k_i",
  "wordCount" : "1709",
  "inLanguage": "zh",
  "datePublished": "2023-07-11T08:00:00+08:00",
  "dateModified": "2023-07-11T08:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "p1um"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://p1um3r.github.io/blog/rsa%E8%A7%A3%E9%A2%98%E6%80%BB%E7%BB%93/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "p1um's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://p1um3r.github.io/favicon.ico"
    }
  }
}
</script>
    <link rel="icon" href="/images/avatar.jpg" sizes="16x16">

<link rel="apple-touch-icon" href="/images/avatar.jpg">

<link rel="manifest" href="/images/avatar.jpg">

    <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css" />

    
    
    
    <link rel="stylesheet" href="/css/main.min.897d93b9b9e7b21b53ef910ded5e54637c71c3edce990f4fee9c0fd62a7a1515.css" integrity="sha256-iX2TubnnshtT75EN7V5UY3xxw&#43;3OmQ9P7pwP1ip6FRU=" crossorigin="anonymous" media="screen" />
    


    
    <link rel="stylesheet" href="/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css" />

    
    <script src="/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js"></script>
    <script>hljs.highlightAll();</script>

    <script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script>
    </head>
<body>
      <main class="wrapper"><nav class="navigation">
    <section class="container">
        <a class="navigation-brand" href="/">
            主页
        </a>
        <input type="checkbox" id="menu-toggle" />
        <label class="menu-button float-right" for="menu-toggle">
            <span></span><span></span><span></span>
        </label>
        
        <ul class="navigation-list" id="navigation-list">
            
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/blog/">文章</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/tags/">分类</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/archives/">历史文章</a>
            </li>
            
            

            <li class="navigation-item menu-separator">
                <span>|</span>
            </li>

            
            
            <li class="navigation-item navigation-social">
                <a class="navigation-link" href="https://github.com/p1um3r"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
            </li>
            
            

            <li class="navigation-item navigation-dark">
                <button id="mode" type="button" aria-label="toggle user light or dark theme">
                    <span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
                    <span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
                </button>
            </li>

            
        </ul>
        
    </section>
</nav>
<div id="content">
<article class="blog-single">
  <header class="blog-title">
    <h1>RSA解题总结</h1>
    <style type="text/css">
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-thumb {
        height: 40px;
        background-color: #eee;
        border-radius: 16px;
        &:hover {
          background-color: #ddd;
        }
      }
    </style>
  </header>

  <p>
  <small>
    2023年7月11日&nbsp;· 1709 字&nbsp;· 9 分钟</small>

  
<p>

  <div class="blog-toc" style="position: fixed; left:50px;max-width:300px; overflow:auto; top: 100px; width: 15vw; bottom:50px">
    
<div class="post-toc" id="post-toc">
<aside>
    <header>
    <h3>RSA解题总结</h3>
    </header>
    
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1一般情况">1、一般情况</a>
      <ul>
        <li><a href="#加密">加密</a></li>
        <li><a href="#解密">解密</a></li>
      </ul>
    </li>
    <li><a href="#2共模数攻击">2、共模数攻击</a>
      <ul>
        <li><a href="#原理">原理</a></li>
        <li><a href="#证明">证明</a></li>
        <li><a href="#攻击流程">攻击流程</a></li>
        <li><a href="#实现">实现</a></li>
      </ul>
    </li>
    <li><a href="#3低加密指数广播攻击">3、低加密指数广播攻击</a>
      <ul>
        <li><a href="#适用情况">适用情况</a></li>
        <li><a href="#实现-1">实现</a></li>
      </ul>
    </li>
    <li><a href="#4素数分解">4、素数分解</a>
      <ul>
        <li><a href="#方法">方法</a></li>
      </ul>
    </li>
    <li><a href="#5低加密指数攻击">5、低加密指数攻击</a>
      <ul>
        <li><a href="#原理-1">原理</a></li>
        <li><a href="#实现-2">实现</a></li>
      </ul>
    </li>
    <li><a href="#6低解密指数攻击-wiener-attack">6、低解密指数攻击 (Wiener Attack)</a>
      <ul>
        <li><a href="#实现-3">实现</a></li>
      </ul>
    </li>
    <li><a href="#7p---1光滑数分解">7、$p - 1$光滑数分解</a>
      <ul>
        <li><a href="#前置知识">前置知识</a></li>
        <li><a href="#概述">概述</a></li>
        <li><a href="#原理-2">原理</a></li>
        <li><a href="#实现-4">实现</a></li>
      </ul>
    </li>
    <li><a href="#8p1光滑数分解">8、$p+1$光滑数分解</a></li>
    <li><a href="#9dp泄露">9、$dp$泄露</a>
      <ul>
        <li><a href="#实现-5">实现</a></li>
      </ul>
    </li>
    <li><a href="#10common-prime-rsa">10、Common Prime RSA</a>
      <ul>
        <li><a href="#简介">简介</a></li>
        <li><a href="#生成算法">生成算法</a></li>
        <li><a href="#攻击">攻击</a></li>
      </ul>
    </li>
    <li><a href="#11coppersmith定理攻击">11、coppersmith定理攻击</a>
      <ul>
        <li><a href="#基本原理">基本原理</a></li>
      </ul>
    </li>
    <li><a href="#12e和phi不互素">12、e和phi不互素</a>
      <ul>
        <li><a href="#gcdeφn--1">gcd(e,φ(n)) ≠ 1</a></li>
      </ul>
    </li>
  </ul>
</nav>
    
    
</aside>
<a href="#" id="toc-toggle"></a>
</div>



  </div>

  <section class="blog-content"><h1 id="rsa解题总结">RSA解题总结</h1>
<h2 id="1一般情况">1、一般情况</h2>
<ul>
<li>
<h3 id="加密">加密</h3>
</li>
<li>
<h3 id="解密">解密</h3>
</li>
</ul>
<pre tabindex="0"><code>p = 1325465431
q = 152317153
e = 65537
</code></pre><p>方法一：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> libnum
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>print(libnum<span style="color:#f92672">.</span>n2s(int(m)))
</span></span></code></pre></div><p>方法二：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.PublicKey <span style="color:#f92672">import</span> RSA
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> PKCS1_OAEP
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> binascii
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>rsa_components <span style="color:#f92672">=</span> (n, e, int(d), p, q)
</span></span><span style="display:flex;"><span>arsa <span style="color:#f92672">=</span> RSA<span style="color:#f92672">.</span>construct(rsa_components)
</span></span><span style="display:flex;"><span>rsakey <span style="color:#f92672">=</span> RSA<span style="color:#f92672">.</span>importKey(arsa<span style="color:#f92672">.</span>exportKey())
</span></span><span style="display:flex;"><span>rsakey <span style="color:#f92672">=</span> PKCS1_OAEP<span style="color:#f92672">.</span>new(rsakey)
</span></span><span style="display:flex;"><span>decrypted <span style="color:#f92672">=</span> rsakey<span style="color:#f92672">.</span>decrypt(c)
</span></span><span style="display:flex;"><span>print(decrypted)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 用于加密时经过填充，导致c和n长度一样的情况，此时用pow解会出现乱码</span>
</span></span></code></pre></div><h2 id="2共模数攻击">2、共模数攻击</h2>
<ul>
<li>
<h3 id="原理">原理</h3>
</li>
</ul>
<p>任何两个用户具有相同的模数都是不安全的，因为每个用户都可以轻松地将模数分解。</p>
<p>假设用户生成了$r$个拥有共模数$N$的$RSA$素数，可以得到$r$个方程式：
$$
\begin{equation}
\begin{split}
e_1d_1 =&amp; 1 + k_1\lambda(N)\newline
&amp;\vdots\newline
e_rd_r =&amp; 1 + k_r\lambda(N)
\end{split}
\end{equation}
$$
其中 $k_i&lt;d_i$恒成立。由于每个私有指数$e$都很小，所以我们假设每个公共指数都是足够大的。</p>
<p>共模数攻击是基于维纳攻击</p>
<p><img src="https://p1um3r.github.io/images/RSA%E8%A7%A3%E9%A2%98%E6%80%BB%E7%BB%93/image-20230806165716546.png" alt="image-20230806165716546"></p>
<p>$$
e_id_i=1+k_i\lambda(N)=1+\frac{k_i}{g}\phi(N)=1+\frac{k_i}{g}(N-s)
$$
我们用$W_i$来表示$g$乘以第$i$个密钥方程。写作：
$$
W_i:e_id_ig-k_iN=g-k_is
$$
$W_i$是维纳攻击的起点。</p>
<p>由于每个人方程式中的$\lambda(N)$的值都相同，所以可以将任意两个方程式结合起来来获得一个不含$\lambda(N)$的新方程。
$$
e_id_i=1+k_i\lambda(N)\newline
e_jd_j=1+k_j\lambda(N)\newline
k_je_id_i=k_j+k_jk_i\lambda(N)\newline
k_ie_jd_j=k_i+k_jk_i\lambda(N)\newline
$$
合并得到：
$$
G_{i,j}:k_id_je_j-k_jd_ie_i=k_i-k_j
$$
这个方程式$G_{i,j}$是共模数攻击的起点。</p>
<p>对于每个例子，我们可以假定公共指数足够大（$e_i\approx N$)，$g=\gcd(p-1,q-1)$较小（假定$\frac{g}{k_i}&lt;1$恒成立）</p>
<p>这种攻击方式是一种基于格的攻击。</p>
<ul>
<li>
<h3 id="证明">证明</h3>
</li>
</ul>
<p>利用上述，我们考虑两个有共模数$N$的$RSA$，每个的私有指数都小于$N^{\delta_2}$，我们得到以下几个方程：
$$
k_2W_1:k_2d_1ge_1-k_2k_1N=k_2(g-k_1s)\newline
gG_{1,2}:k_1d_2ge_2-k_2d_1ge_1=g(k_1-k_2)\newline
W_1W_2:d_1d_2g^2e_1e_2-d_1k_2ge_1N-d_2k_1ge_2N+k_1k_2N^2=(g-k_1s)(g-k_2s)
$$
同时，平凡方程$k_1k_2=k_1k_2$可以写成向量矩阵方程$x_2 \mathcal{B}_2 =v_2$，其中：
$$
\begin{align}
x_2&amp;=(k_1k_2,k_2d_1g,k_1d_2g,d_1d_2g^2)\newline
\mathcal{B}_2&amp;=
\begin{bmatrix}
1&amp;-N&amp;0&amp;N^2\newline
&amp;e_1&amp;-e_1&amp;-e_1N\newline
&amp;&amp;e_2&amp;-e_2N\newline
&amp;&amp;&amp;e_1e_2
\end{bmatrix}\newline
v_2&amp;=(j_1k_2,k_2(g-k_1s),g(k_1-k_2),(g-k_1s)(g-k_2s))
\end{align}
$$
$v_2$是$\mathcal{B}_2$中行向量的线性组合，同时也是由$\mathcal{B}_2$的行向量生成的格$\mathcal{L}_2$中的一个向量。</p>
<ul>
<li>
<h3 id="攻击流程">攻击流程</h3>
</li>
</ul>
<p>1.攻击者获得两个或多个$RSA$公钥，它们共用相同的模数$n$。</p>
<p>2.攻击者选取一个消息$m$，并对其进行加密，得到密文$c_1=m^{e_1} \bmod n$和$c_2=m^{e_2} \bmod n$，其中$e_1$和$e_2$分别是两个公钥中的指数</p>
<p>3.攻击者寻找模数$n$和两个指数$e_1$和$e_2$的最大公约数$\gcd(e_1,e_2)$，并将其命名为$g$。</p>
<p>4.如果$g$不等于 1，则说明攻击者找到了至少一个质因数$p$或$q$,并可以用它来推导$RSA$私钥中的指数$d$。</p>
<p>5.通过继续计算，攻击者可以确定私钥中的指数$d$，并从而获得原始消息$m$。</p>
<ul>
<li>
<h3 id="实现">实现</h3>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> gcdext
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> libnum
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa6241c28743fbbe4f2f67cee7121497f622fd81947af30f327fb028445b39c2d517ba7fdcb5f6ac9e6217205f8ec9576bdec7a0faef221c29291c784eed393cd95eb0d358d2a1a35dbff05d6fa0cc597f672dcfbeecbb14bd1462cb6ba4f465f30f22e595c36e6282c3e426831d30f0479ee18b870ab658a54571774d25d6875</span>
</span></span><span style="display:flex;"><span>e1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x3045</span>
</span></span><span style="display:flex;"><span>e2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xff4d</span>
</span></span><span style="display:flex;"><span>c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5d1e39bc751108ec0a1397d79e63c013d238915d13380ae649e84d7d85ebcffbbc35ebb18d2218ccbc5409290dfa8a4847e5923c3420e83b1a9d7aa67190dc0d34711cce261665c64c28ed2834394d4b181926febf7eb685f9ce81f36c7fb72798da3a14a123287171d26e084948aab0fba81c53f10b5696fc291006254ee690</span>
</span></span><span style="display:flex;"><span>c2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x3d90f2bec4fe02d8ce4cece3ddb6baed99337f7e6856eef255445741b5cfe378390f058679d70236e51be4746db4c207f274c40b092e24f8c155a0957867e84dca48e27980af488d2615a280c6eadec2f1d30b95653b1ee3135e2edff100dd2c529994f846722f811348b082d0bec7cfab579a4bd0ab789928b1bebed68d628f</span>
</span></span><span style="display:flex;"><span>g, r, s <span style="color:#f92672">=</span> gcdext(e1, e2)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c1, r, n) <span style="color:#f92672">*</span> pow(c2, s, n) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>print(libnum<span style="color:#f92672">.</span>n2s(int(m)))
</span></span></code></pre></div><h2 id="3低加密指数广播攻击">3、低加密指数广播攻击</h2>
<ul>
<li>
<h3 id="适用情况">适用情况</h3>
</li>
</ul>
<p>e很小，并且使用了相同的加密指数e给若干个接收者发送相同的信息</p>
<p>例如当$e=3$时，有以下等式成立：
$$
c_1 = pow(m,e,n_1)\newline
c_2 = pow(m,e,n_2)\newline
c_3 = pow(m,e,n_3)\newline
&hellip;
$$
对上列等式运用中国剩余定理，得到
$$
c_x = pow(m,e,n_1<em>n_2</em>n_3*&hellip;)
$$
随后再进行低加密指数攻击。</p>
<ul>
<li>
<h3 id="实现-1">实现</h3>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">CRT</span>(clist, nlist):
</span></span><span style="display:flex;"><span>    N <span style="color:#f92672">=</span> reduce(<span style="color:#66d9ef">lambda</span> x, y: x <span style="color:#f92672">*</span> y, nlist)
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c, n <span style="color:#f92672">in</span> zip(clist, nlist):
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">=</span> N <span style="color:#f92672">//</span> n
</span></span><span style="display:flex;"><span>        d, r, s <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>gcdext(n, m)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> d <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>: <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Input not pairwise co-prime&#34;</span>)
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> c <span style="color:#f92672">*</span> s <span style="color:#f92672">*</span> m
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result <span style="color:#f92672">%</span> N, N
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> [<span style="color:#ae81ff">142782424368849674771976671955176187834932417027468006479038058385550042422280158726561712259205616626939123504489410624745195777853423961104590708231562726165590769610040722589287393102301338152085670464005026301781192671834390892019478189768725018303217559795377795540494239283891894830166363576205812991157</span>, <span style="color:#ae81ff">153610425077816156109768509904751446801233412970601397035720458311275245730833227428213917577405780162151444202393431444812010569489900435979730559895340377469612234558042643742219128033827948585534761030527275423811282367831985007507137144308704413007806012914286105842311420933479771294576841956749281552971</span>, <span style="color:#ae81ff">152540067782701001222493009941492423063369171831039847414320547494725020441901272486665728360741395415762864872737675660423920609681185809510355937534756399208661762715484879562585724584849261266873624875852300611683382543315580370484972470694466195837255994159609193239840228218925381488410059939975556977947</span>, <span style="color:#ae81ff">125842716702134814646356078531900645012495638692517778270527426844383063904041812273637776798591687732598509470005151551320457132061693618473039437320011446697406190781306264437609046721508738109650829547010385875425097336266103994639126319889016342284747700714199556143378526590058467791687837422897022829661</span>, <span style="color:#ae81ff">116144389285266462769913139639175922392318396923181100785008570884082681963637784423143843845816350379438789947802939701820129805341796427821894273985551331666719808355412080909245720551238149511778060242720419584504473490216670437024863860559347959698828131475160058721701582089480924088773887932997353631767</span>, <span style="color:#ae81ff">127833907448946785858374094953899556339175475846831397383049660262333005992005484987913355932559627279178940862787593749842796469355336182379062826441222705075178971785791223706944120681105575965622931327112817747065200324610697178273898956820957640413744954233327851461318200323486469677469950386824833536523</span>, <span style="color:#ae81ff">130561613227079478921314550968562766645507834694262831586725464124109153306162445639759476845681271537955934718244296904503168256991962908095007040044300188572466395275317838178325500238288302672390013747102961340256309124310478931896245221622317302428447389760864327859640573452084295225059466376349115703119</span>, <span style="color:#ae81ff">115953389401040751013569404909249958538962411171147823610874077094621794755967854844224923689925397631692572916641171075740839099217316101334941033937183815345038898177087515909675028366437302462022970987947264115373697445950951595479758872029099661065186221250394358255523574834723958546450323357472451930993</span>, <span style="color:#ae81ff">143437107845384843564651522639125300763388830136500260725097766445883003928355325003575359566631064630487365774344508496878731109174874449170057678821440711511966073934025028100604234445470976333825866939923998344367645612128590820812489407412175198698290167077116185959180877334222693344630253253476594907313</span>]
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> [<span style="color:#ae81ff">85033868418784308573673709960700777350314426427677627319697346811123742342359072170220428874952996988431950989321281905284522596263957356289624365171732095210045916218066135140320107686084053271623461104022705353814233772164502775939590711842361956121603943483040254727995655776263673058788416722141673409688</span>, <span style="color:#ae81ff">66065963470666895005407449599703926269325406456711861190876894466341571726360462706664546294453572319565476664348345756905411939632955966517708138047546806602828064213238537646393524578984547577761559965654539771172357089802682793169968961304179886652390277814477825753096636750388350662980872556701402397564</span>, <span style="color:#ae81ff">116011740820520887443111656288411611070614127688662643257265381793048354928820176624229624692124188995846076431510548507016903260774215950803926107831505634778278712070141663189086436127990584944132764896694777031370995058271038329228336417590284517922855284619653301817355115583540545182119702335431334401666</span>, <span style="color:#ae81ff">97640420284096094887471273365295984332267897927392169402918423863919914002451127544715668846623138003564829254309568918651163254043205129883843425179687841236818720463784828905460885026290909768599562386370732119591181513319548915478512030197629196018254041500662654260834562708620760373487652389789200792120</span>, <span style="color:#ae81ff">8112507653841374573057048967617108909055624101437903775740427861003476480616929517639719198652146909660899632120639789106782550275648578142883715280547602249589837441805676364041484345030575130408744621981440093280624046635769338568542048839419939250444929802135605724150484414516536378791500915047844188300</span>, <span style="color:#ae81ff">36792148360808115566234645242678223867680969786675055638670907933041180936164293809961667801099516457636164692292891528415720085345494773373966277807505798679784807614784581861287048096977968620964436947452527540958289441390882589051225367658014709290392321808926567572528170531844664734909469690750971883323</span>, <span style="color:#ae81ff">53043093283305492238903255767698153246673671181809989362223466090875767705978690531154079519999671834688647277179370374802495005937892824566602423646978168777735383632928274082669949750078161820002768640908750005814934158829006019656592134357897586040866207754535586785064545866404380204728594863102313407789</span>, <span style="color:#ae81ff">88499407133762624445946519155722583633934260410706930537441122463087556094734626189377091740335667052378955691250910459790202385799502439716173363179773811920751410726795431402796346647688144853156900427797933862087074385441977254140336390678022955770879265490567987868532251217565094093318626424653599450992</span>, <span style="color:#ae81ff">138337520305048557335599940473834485492131424901034295018189264168040969172072024612859307499682986987325414798210700710891033749119834960687318156171051379643844580970963540418974136891389303624057726575516576726845229494107327508855516437230240365759885913142671816868762838801720492804671259709458388192984</span>]
</span></span><span style="display:flex;"><span>x, n <span style="color:#f92672">=</span> CRT(c, n)
</span></span><span style="display:flex;"><span>m, flag <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>iroot(x, e)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> flag:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;m=</span><span style="color:#e6db74">{</span>m<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;could not decode m&#34;</span>)
</span></span></code></pre></div><h2 id="4素数分解">4、素数分解</h2>
<ul>
<li>
<h3 id="方法">方法</h3>
</li>
</ul>
<p>1、n值为<strong>临近</strong>素数相乘得到可用yafu分解</p>
<h2 id="5低加密指数攻击">5、低加密指数攻击</h2>
<ul>
<li>
<h3 id="原理-1">原理</h3>
</li>
</ul>
<p>在 RSA 中 e 也称为加密指数。</p>
<p>由于 e 是可以随意选取的，选取小一点的 e 可以缩短加密时间，但是选取不当的话，就会造成安全问题。</p>
<p>若$m^3 &lt; n$，即$c = m^3$</p>
<p>若$m^3 &gt; n$但并非$m^3 \gg n$，即$c = (m^3 + i * n) \bmod n$，其中$i$是我们需要爆破的系数</p>
<ul>
<li>
<h3 id="实现-2">实现</h3>
</li>
</ul>
<p>若$m^3 &lt; n$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span>n<span style="color:#f92672">=</span> <span style="color:#ae81ff">22885480907469109159947272333565375109310485067211461543881386718201442106967914852474989176175269612229966461160065872310916096148216253429849921988412342732706875998100337754561586600637594798877898552625378551427864501926224989873772743227733285336042475675299391051376624685754547818835551263597996620383338263448888107691240136257201191331617560711786674975909597833383395574686942099700631002290836152972352041024137872983284691831292216787307841877839674258086005814225532597955826353796634417780156185485054141684249037538570742860026295194559710972266059844824388916869414355952432189722465103299013237588737</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>c<span style="color:#f92672">=</span> <span style="color:#ae81ff">15685364647213619014219110070569189770745535885901269792039052046431067708991036961644224230125219358149236447900927116989931929305133870392430610563331490276096858863490412102016758082433435355613099047001069687409209484751075897343335693872741</span>
</span></span><span style="display:flex;"><span>m, flag <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>iroot(c, e)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> flag:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;m=</span><span style="color:#e6db74">{</span>m<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;could not decode m&#34;</span>)
</span></span></code></pre></div><p>若$m^3&gt;n$但并非$m^3\gg n$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">114976915747243387792157708464120735018971336213935438953074748276198282761939060395482051056351068439137722626185590043024556656813730840050547350912425438364703854627760482842307943026011880815011654341047422453012558617703411700393668892701036222135444420377515575624398723436532681305293727164639582093389</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">5828813410620741112500628876643872258919868379601617907887884191584237969605489971465692568848339200057188383649365078832766143513766368216471491824042974016773526107276856706832404477882581400769791378958901067683158857990261489285951805740071223765359992165262854641069674603160977034446644199945940251030</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    m, flag <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>iroot(c <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> n, e)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> flag:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;m=</span><span style="color:#e6db74">{</span>m<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h2 id="6低解密指数攻击-wiener-attack">6、低解密指数攻击 (Wiener Attack)</h2>
<ul>
<li>
<h3 id="实现-3">实现</h3>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">transform</span>(x, y):  <span style="color:#75715e"># 使用辗转相处将分数 x/y 转为连分数的形式</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> y:
</span></span><span style="display:flex;"><span>        res<span style="color:#f92672">.</span>append(x<span style="color:#f92672">//</span>y)
</span></span><span style="display:flex;"><span>        x, y <span style="color:#f92672">=</span> y, x <span style="color:#f92672">%</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">continued_fraction</span>(sub_res):
</span></span><span style="display:flex;"><span>    numerator, denominator <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> sub_res[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:  <span style="color:#75715e"># 从sublist的后面往前循环</span>
</span></span><span style="display:flex;"><span>        denominator, numerator <span style="color:#f92672">=</span> numerator, i<span style="color:#f92672">*</span>numerator<span style="color:#f92672">+</span>denominator
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> denominator, numerator  <span style="color:#75715e"># 得到渐进分数的分母和分子，并返回</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 求解每个渐进分数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sub_fraction</span>(x, y):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> transform(x, y)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将连分数的结果逐一截取以求渐进分数</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> list(map(continued_fraction, (res[<span style="color:#ae81ff">0</span>:i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, len(res)))))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_pq</span>(a, b, c):  <span style="color:#75715e"># 由p+q和pq的值通过维达定理来求解p和q</span>
</span></span><span style="display:flex;"><span>    par <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>isqrt(b<span style="color:#f92672">*</span>b<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>a<span style="color:#f92672">*</span>c)  <span style="color:#75715e"># 由上述可得，开根号一定是整数，因为有解</span>
</span></span><span style="display:flex;"><span>    x1, x2 <span style="color:#f92672">=</span> (<span style="color:#f92672">-</span>b<span style="color:#f92672">+</span>par)<span style="color:#f92672">//</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>a), (<span style="color:#f92672">-</span>b<span style="color:#f92672">-</span>par)<span style="color:#f92672">//</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>a)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x1, x2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wienerAttack</span>(e, n):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (d, k) <span style="color:#f92672">in</span> sub_fraction(e, n):  <span style="color:#75715e"># 用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> k <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:  <span style="color:#75715e"># 可能会出现连分数的第一个为0的情况，排除</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e<span style="color:#f92672">*</span>d<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> k <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:  <span style="color:#75715e"># ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        phi <span style="color:#f92672">=</span> (e<span style="color:#f92672">*</span>d<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">//</span>k  <span style="color:#75715e"># 这个结果就是 φ(n)</span>
</span></span><span style="display:flex;"><span>        px, qy <span style="color:#f92672">=</span> get_pq(<span style="color:#ae81ff">1</span>, n<span style="color:#f92672">-</span>phi<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, n)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> px<span style="color:#f92672">*</span>qy <span style="color:#f92672">==</span> n:
</span></span><span style="display:flex;"><span>            p, q <span style="color:#f92672">=</span> abs(int(px)), abs(int(qy))  <span style="color:#75715e"># 可能会得到两个负数，负负得正未尝不会出现</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span>
</span></span><span style="display:flex;"><span>            d <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>invert(e, (p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> d
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;该方法不适用&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">507419170088344932990702256911694788408493968749527614421614568612944144764889717229444020813658893362983714454159980719026366361318789415279417172858536381938870379267670180128174798344744371725609827872339512302232610590888649555446972990419313445687852636305518801236132032618350847705234643521557851434711389664130274468354405273873218264222293858509477860634889001898462547712800153111774564939279190835857445378261920532206352364005840238252284065587291779196975457288580812526597185332036342330147250312262816994625317482869849388424397437470502449815132000588425028055964432298176942124697105509057090546600330760364385753313923003549670107599757996810939165300581847068233156887269181096893089415302163770884312255957584660964506028002922164767453287973102961910781312351686488047510932997937700597992705557881172640175117476017503918294534205898046483981707558521558992058512940087192655700351675718815723840568640509355338482631416345193176708501897458649841539192993142790402734898948352382350766125000186026261167277014748183012844440603384989647664190074853086693408529737767147592432979469020671772152652865219092597717869942730499507426269170189547020660681363276871874469322437194397171763927907099922324375991793759</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">77310199867448677782081572109343472783781135641712597643597122591443011229091533516758925238949755491395489408922437493670252550920826641442189683907973926843505436730014899918587477913032286153545247063493885982941194996251799882984145155733050069564485120660716110828110738784644223519725613280140006783618393995138076030616463398284819550627612102010214315235269945251741407899692274978642663650687157736417831290404871181902463904311095448368498432147292938825418930527188720696497596867575843476810225152659244529481480993843168383016583068747733118703000287423374094051895724494193455175131120243097065270804457787026492578916584536863548445813916819417857064037664101684455000184987531252344582899589746272173970083733130106407810619258077266603898529285634495710846838011858287024329514491058790557305041389614650730267774482954666726949886313386881066593946789460028399523245777171320319444673551268379126203862576627540177888290265714418064334752499940587750374552330008143708562065940245637685833371348603338834447212248648869514585047871442060412622164276894766238383894693759347590977926306581080390685360615407766600573527565016914830132066428454738135380178959590692145577418811677639050929791996313180297924833690095</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">165251729917394529793163344300848992394021337429474789711805041655116845722480301677817165053253655027459227404782607373107477419083333844871948673626672704233977397989843349633720167495862807995411682262559392496273163155214888276398332204954185252030616473235814999366132031184631541209554169938146205402400412307638567132128690379079483633171535375278689326189057930259534983374296873110199636558962144635514392282351103900375366360933088605794654279480277782805401749872568584335215630740265944133347038070337891035560658434763924576508969938866566235926587685108811154229747423410476421860059769485356567301897413767088823807510568561254627099309752215808220067495561412081320541540679503218232020279947159175547517811501280846596226165148013762293861131544331444165070186672186027410082671602892508739473724143698396105392623164025712124329254933353509384748403154342322725203183050328143736631333990445537119855865348221215277608372952942702104088940952142851523651639574409075484106857403651453121036577767672430612728022444370874223001778580387635197325043524719396707713385963432915855227152371800527536048555551237729690663544828830627192867570345853910196397851763591543484023134551876591248557980182981967782409054277224</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> wienerAttack(e, n)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span></code></pre></div><h2 id="7p---1光滑数分解">7、$p - 1$光滑数分解</h2>
<ul>
<li>
<h3 id="前置知识">前置知识</h3>
</li>
</ul>
<p>费马小定理$(Fermat Theorem)$：若$p$是素数，且$p \nmid a$,则$a^{p-1} \equiv 1(\bmod p)$</p>
<p>​                 $//$本来是$a^p \equiv a(\bmod p)$，为了方便我们写成上面的形式</p>
<p>$B-Smooth$数：如果一个整数的所有素因子都不大于B，我们称这个整数为$B-Smooth$数。</p>
<p>例$1:12=2<em>2</em>3$，因此$12$是$3-Smooth$的数</p>
<p>例$2:30=2<em>3</em>5$，因此$130$是$5-Smooth$的数</p>
<ul>
<li>
<h3 id="概述">概述</h3>
</li>
</ul>
<p>光滑数 (Smooth number)：指可以分解为小素数乘积的正整数</p>
<p>当p是N 的因数，并且p−1是光滑数，可以考虑使用<code>Pollard's p-1</code>算法来分解N</p>
<p>当p是N的因数，并且p+1是光滑数，可以考虑使用<code>Williams's p+1</code>算法来分解N</p>
<ul>
<li>
<h3 id="原理-2">原理</h3>
</li>
</ul>
<p>设$p-1$是$B-Smooth$的，可设$p-1=p_1p_2&hellip;p_n(\forall 1\le i\le n,p_i\le B)$</p>
<p>若$p_1,p_2,&hellip;,p_n$两两不同，则$p_1p_2&hellip;p_n\mid B! \Rightarrow (p-1)\mid B!\Rightarrow B!=k(p-1)$。因此$a^{B!} \equiv a^{k(p-1)}\equiv 1(\bmod p)$</p>
<p>假设$N=pq$，计算$\gcd(a^{B!}-1, N)$，只要结果大于$0$小于$N$，那么结果就为$p$</p>
<p><img src="https://p1um3r.github.io/images/RSA%E8%A7%A3%E9%A2%98%E6%80%BB%E7%BB%93/8f6e63a2fa13494a81e0f65c2ccf1c9d.png" alt="在这里插入图片描述"></p>
<ul>
<li>
<h3 id="实现-4">实现</h3>
</li>
</ul>
<p>方法一：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>P <span style="color:#f92672">=</span> prod(primes)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 这里的2是任取的</span>
</span></span><span style="display:flex;"><span>pp <span style="color:#f92672">=</span> pow(<span style="color:#ae81ff">2</span>, P, n) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> gcd(pp, n)
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> int(p)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">==</span> n
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> inverse_mod(e, phi)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span></code></pre></div><p>方法二：</p>
<pre tabindex="0"><code>from gmpy2 import *
a = 2
n = 2
while True:
    a = pow(a, n, N)
    res = gcd(a-1, N)
    if res != 1 and res != N:
        q = N // res
        print(&#34;p=&#34;,res)
        print(&#34;q=&#34;,q)
        break
    n += 1
</code></pre><h2 id="8p1光滑数分解">8、$p+1$光滑数分解</h2>
<h2 id="9dp泄露">9、$dp$泄露</h2>
<ul>
<li>
<h3 id="实现-5">实现</h3>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gmpy2
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> libnum
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113</span>
</span></span><span style="display:flex;"><span>dp <span style="color:#f92672">=</span> <span style="color:#ae81ff">905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, e <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (dp <span style="color:#f92672">*</span> e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> n <span style="color:#f92672">%</span> (((dp <span style="color:#f92672">*</span> e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> i) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> ((dp <span style="color:#f92672">*</span> e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> i) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> (((dp <span style="color:#f92672">*</span> e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> i) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>invert(e, phi)
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">=</span> int(pow(c, d, n))
</span></span><span style="display:flex;"><span>print(libnum<span style="color:#f92672">.</span>n2s(m))
</span></span></code></pre></div><h2 id="10common-prime-rsa">10、Common Prime RSA</h2>
<ul>
<li>
<h3 id="简介">简介</h3>
</li>
</ul>
<p>Wiener 提出，如果 $p$ 和 $q$ 是素数，使得 $p-1$ 和 $q-1$ 有一个大数因子，那么具有这种性质的素数可以作为 Wiener Attack 的反制措施。</p>
<p>根据这种理论，出现了一种 $p-1$ 和 $q-1$ 拥有一个共同的大素数因子的 RSA 变体，我们称作共素数RSA（Common Prime RSA）。</p>
<p>对于某个大素数 $g$，让 $p=2ga+1$ 且 $q=2gb+1$ 作为平衡素数，保证 $a,b$ 互素且 $h=2gab+a+b$ 是素数。第一个限制确保 $\gcd(p-1,q-1)=2g$，第二个限制确保 $(pq-1)/2=gh$ 与 $N=pq$ 的大小接近。</p>
<p>因为由上述算法生成的素数 $p,q$ 满足 $g=\gcd(p-1,q-1)$ 是一个大素数因子，故称 $p,q$ 为共素数（common primes）。其中 $g$ 为这两个素数的共因子（common factor）。</p>
<p>我们需要注意到对于共素数RSA有着以下性质：
$$
\lambda(pq)=\mathrm{lcm}(p-1,q-1)=\mathrm{lcm}(2ga,2gb)=2gab\
\varphi(pq)=(p-1)(q-1)=2ga2gb=2g\lambda(pq)
$$
此外存在额外定义，RSA加密指数和解密指数需要与 $\lambda(pq)$ 互素。</p>
<p>根据上述定义，可以推导出
$$
N=pq=(2ga+1)(2gb+1)=2g(2gab+a+b)+1=2gh+1
$$
即 $N-1$ 为
$$
N-1=2g(2gab+a+b)=2gh
$$
定义 $\gamma$ 表示共因子 $g$ 的相对于 $N$ 的大小，即 $g=N^\gamma$。考虑 $g\leq N^{1/2}$，故 $0\leq\gamma\leq1/2$。</p>
<ul>
<li>
<h3 id="生成算法">生成算法</h3>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    gcd
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">NameError</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> gcd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_prime</span>(nbits: int, gamma: float):
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> getPrime(int(nbits <span style="color:#f92672">*</span> gamma))
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">-</span> gamma
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> getRandomNBitInteger(int(alpha <span style="color:#f92672">*</span> nbits))
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isPrime(p):
</span></span><span style="display:flex;"><span>            b <span style="color:#f92672">=</span> getRandomNBitInteger(int(alpha <span style="color:#f92672">*</span> nbits))
</span></span><span style="display:flex;"><span>            q <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            h <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> b
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> isPrime(q) <span style="color:#f92672">or</span> isPrime(h) <span style="color:#f92672">or</span> gcd(a, b) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                b <span style="color:#f92672">=</span> getRandomNBitInteger(int(alpha <span style="color:#f92672">*</span> nbits))
</span></span><span style="display:flex;"><span>                q <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> p, q
</span></span><span style="display:flex;"><span>print(gen_prime(<span style="color:#ae81ff">512</span>, <span style="color:#ae81ff">0.48</span>))
</span></span></code></pre></div><ul>
<li>
<h3 id="攻击">攻击</h3>
</li>
<li>
<h4 id="gamma-接近于-12">$\gamma$ 接近于 $1/2$</h4>
</li>
</ul>
<p>当 $\gamma$ 接近于 $1/2$ 时，$g=N^\gamma$ 接近于 $N^{1/2}$，由于共素数RSA的特殊构造我们可以在 $O(N^{1/4-\gamma/2})$ 分解 $N$，故此时算法时间复杂度接近于 $O(1)$。</p>
<p>此时我们只需修改 <code>Pollard's rho method</code> 的 $x_i$ 函数。</p>
<p>在 Mckee&amp;Pinch 的论文<a href="https://citeseerx.ist.psu.edu/doc_view/pid/64294c404088b69a519614510b8d12b4809a6b10">《Further Attacks on Server-Aided RSA Cryptosystems》</a>中指出将 $f(x)=x^2+1$ 修改为 $f(x)=x^{N-1}+3\pmod{N}$ 是最优解。</p>
<p>由于 $N-1=2gh$ 且 $p-1=2ga$，故最多只有一个值不在 $x^{N-1}\mod{p}$ 的环中。</p>
<p>算法实现如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    gcd
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">NameError</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> gcd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rho</span>(N):
</span></span><span style="display:flex;"><span>    f <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x: (pow(x, N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, N) <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">%</span> N
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 加快入环速度</span>
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">2</span>, N)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> f(t)
</span></span><span style="display:flex;"><span>        step_times <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        step_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> step_times <span style="color:#f92672">&lt;</span> step_limit:
</span></span><span style="display:flex;"><span>                step_times <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                step_limit <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                t <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>                h <span style="color:#f92672">=</span> f(h)
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> gcd(abs(int(t) <span style="color:#f92672">-</span> int(h)), N)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> p <span style="color:#f92672">==</span> N:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> p <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> (p, N <span style="color:#f92672">//</span> p)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                h <span style="color:#f92672">=</span> f(h)
</span></span><span style="display:flex;"><span>                step_times <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(rho(<span style="color:#ae81ff">84236796025318186855187782611491334781897277899439717384242559751095347166978304126358295609924321812851255222430530001043539925782811895605398187299748256080526691975084042025794113521587064616352833904856626744098904922117855866813505228134381046907659080078950018430266048447119221001098505107823645953039</span>))
</span></span></code></pre></div><p>故事实证明 $\gamma$ 值的选取不能过于接近 $1/2$。</p>
<h4 id="已知-ab">已知 $a,b$</h4>
<p>已知 $N=2g(2gab+a+b)+1$，于是我们构造方程
$$
4abg^2+2(a+b)g-N+1=0
$$
可以在多项式时间 $\log(N)$ 内分解 $N$。</p>
<p>Sagemath 代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1185431345934512</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1989628969125971</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">54692260436051338814890781701826055707958209029414126894070449935683071253184867947357262267840171428710181955973010913204514025135188192484651672240708141692701667242130748316666406528479191422804307020656050201187035928715833163999813216597718706449260040885862566373392398826670863398295350419792842640631</span>
</span></span><span style="display:flex;"><span>P<span style="color:#f92672">.&lt;</span>g<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> ZZ[]
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> b <span style="color:#f92672">*</span> g <span style="color:#f92672">^</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (a <span style="color:#f92672">+</span> b) <span style="color:#f92672">*</span> g <span style="color:#f92672">-</span> N <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>g <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>roots()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> g:
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> g[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">==</span> N
</span></span></code></pre></div><p>Python 可以借助 <code>sympy</code> 解方程。</p>
<h4 id="已知-g">已知 $g$</h4>
<p>当 $g\geq a+b$ 时，会导致在多项式时间为 $\log(N)$ 内分解 $N$，同时因为素数是平衡的，条件相当于 $g&gt;N^{1/4}$。</p>
<p>证明如下：</p>
<p>我们假设 $g&gt;a+b$，那么给予 $N,g$，令 $M=(N-1)/(2g)$，$c=a+b$，那么方程
$$
N=2g(2gab+a+b)+1
$$
可以改写成
$$
M=2gab+c
$$
因为 $c=a+b&lt;g$，根据假设，可以归约为模 $g$ 域下的方程：
$$
c=M\pmod{g}
$$
因此，$c=a+b$ 是已知的。</p>
<p>将 $b=c-a$ 带回方程 $N=2g(2gab+a+b)+1$，整理可得二次方程：
$$
2ga^2-2gca+(N-1)/(2g)-c=0
$$
可以解得 $a,b$ 为该方程两解。</p>
<p>假设 $g=a+b$，我们将方程 $N=2g(2gab+a+b)+1$ 作等价替换，整理得到方程
$$
\frac{N-1}{4g^2}=ab+\frac{1}{2}
$$
我们再进一步替换 $b=g-a$，再次整理可得二次方程：
$$
a^2-ga+\frac{N-1}{4g^2}-\frac{1}{2}=0
$$
可以解得 $a,b$。</p>
<p>代码如下：</p>
<p>$g&gt;a+b$ 时，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>g <span style="color:#f92672">=</span> <span style="color:#ae81ff">2056971706333850947354991471886113601423457483931388832864204860321308350537317091564919029078296379733989138742162694786565228112885684303</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">67324909911911622626246005558967775211455024820506932698435813321567574468019013664789401988015894964099052816176029553245881317276340043887466584645914352982274378611180595397686920214079479901514703963131435008906250160656759300390805929849374653321934393399433471228218819498373221757779799476717494079667</span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> (N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g)
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> M <span style="color:#f92672">%</span> g
</span></span><span style="display:flex;"><span>P<span style="color:#f92672">.&lt;</span>a<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> ZZ[]
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">^</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> c <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> M <span style="color:#f92672">-</span> c
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>roots()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> a:
</span></span><span style="display:flex;"><span>    a, b <span style="color:#f92672">=</span> a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>], a[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">==</span> N
</span></span></code></pre></div><p>$g=a+b$ 时，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>g <span style="color:#f92672">=</span> <span style="color:#ae81ff">2855372645569408464444580237486670388029956719716115953907612135874419892154982850222965560661211729647325085879529571229774148545656169021</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">159549169988238873893531105042878385551537587717347282632324748268846735710748763722602882823022008548774298858161130258369850715542192739582830583643642436399008902770027668038725347353393047833875066622910131525247842517372845617227325882916166114361718015983671803859502931814932543107911548450229250776542101141849788751722460468073974316977656001286989710480324512919121409123619799426221232443036698458643438020098037548757403</span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> (N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g)
</span></span><span style="display:flex;"><span>P<span style="color:#f92672">.&lt;</span>a<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> ZZ[]
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">^</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> (N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">^</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>roots()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> a:
</span></span><span style="display:flex;"><span>    a, b <span style="color:#f92672">=</span> a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>], a[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">==</span> N
</span></span></code></pre></div><p>因为 $p=2ga+1$，注意到 $g&gt;N^{1/4}$ 是已知的，故我们也可以用 <code>Coppersmith's factoring</code> 方法分解模数。</p>
<p>而当 $g&lt;a+b$ 时，我们可以使用时间复杂度为 $O(N^{1/4-\gamma})$ 的算法分解 $N$，每个操作的多项式时间为 $\log(N)$。</p>
<p>证明如下：</p>
<p>已知 $g$，我们可以通过除法算法计算 $u$ 和 $0\leq v\leq2g$，例如：
$$
\frac{N-1}{2g}=2gu+v
$$
因为我们知道 $N=2g(2gab+a+b)+1$，于是乎
$$
a+b=v+2gc\
ab=u-c
$$
其中 $c$ 为任意整数。</p>
<p>对于任意与 $N$ 互素的整数 $x$，我们有
$$
x^{u2g}\equiv x^{ab2g+c2g}\equiv x^{c2g}\pmod{N}
$$
因为 $u=ab+c$ 且 $\lambda(N)=2gab$，所以 $x^{2gab}\equiv 1\pmod{N}$。</p>
<p>让 $y=x^{2g}$，我们有
$$
y^u\equiv y^c\pmod{N}
$$
根据这个关系，未知的 $c$ 可以用 Shanks 的小步大步法（baby-step giant-step methodology）求解。对于某些 $d&gt;\sqrt{c}$，我们计算得到大步为
$$
y^0,y^d,y^{2d},\cdots,y^{d^2}\mod{N}
$$
小步为
$$
y^u,y^{u-1},y^{u-2},\cdots,y^{u-d}\mod{N}
$$
在其中搜索碰撞，将会产生一个 $r$ 和 $s$ 满足：
$$
y^{rd}\equiv y^{u-s}\pmod{N}
$$
其中 $c=rd+s$。</p>
<p>当 $c$ 已知，我们可以计算 $a,b$。</p>
<p>计算，排序和搜索需要 $O(d\log(d))$ 操作，其中 $d&gt;\sqrt{c}$。</p>
<p>故使用这种算法需求 $\gamma$ 接近于 $1/4$。</p>
<blockquote>
<p>本人多次跑这个算法，最终验证可得 $c$ 的大致范围大概率会落在 $N^{(1/2-2\gamma)}$ 的附近，取上下浮动两位大小最佳。</p>
</blockquote>
<p>Sagemath 如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.groups.generic <span style="color:#f92672">import</span> bsgs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>g <span style="color:#f92672">=</span> <span style="color:#ae81ff">28838314918840273611038952856252141148393903858815521699377328440901497</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">23895816238623712091906549349650291003358466897973970818205381234024572750472476312894286233088847723906345049342176974080465940396626170377635736786780099297743807402105462746828310247313063710700453371777283064626446124365885063073122303271609231832129823571694756234973129694217982548355078107610764879363</span>
</span></span><span style="display:flex;"><span>nbits <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>gamma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.23</span>
</span></span><span style="display:flex;"><span>cbits <span style="color:#f92672">=</span> ceil(nbits <span style="color:#f92672">*</span> (<span style="color:#ae81ff">0.5</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> gamma))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> (N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g)
</span></span><span style="display:flex;"><span>u <span style="color:#f92672">=</span> M <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g)
</span></span><span style="display:flex;"><span>v <span style="color:#f92672">=</span> M <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> u
</span></span><span style="display:flex;"><span>GF <span style="color:#f92672">=</span> Zmod(N)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> GF<span style="color:#f92672">.</span>random_element()
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> x <span style="color:#f92672">^</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c的范围大概与N^(0.5-2*gamma)很接近</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> bsgs(y, y <span style="color:#f92672">^</span> u, (int(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(cbits<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)), int(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(cbits<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>))))
</span></span><span style="display:flex;"><span>ab <span style="color:#f92672">=</span> u <span style="color:#f92672">-</span> c
</span></span><span style="display:flex;"><span>apb <span style="color:#f92672">=</span> v <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> c
</span></span><span style="display:flex;"><span>P<span style="color:#f92672">.&lt;</span>x<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> ZZ[]
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> x <span style="color:#f92672">^</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> apb <span style="color:#f92672">*</span> x <span style="color:#f92672">+</span> ab
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>roots()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> a:
</span></span><span style="display:flex;"><span>    a, b <span style="color:#f92672">=</span> a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>], a[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> g <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> p <span style="color:#f92672">*</span> q <span style="color:#f92672">==</span> N
</span></span></code></pre></div><h4 id="分解-n-1">分解 $N-1$</h4>
<p>当 $\gamma$ 过小，即 $g=N^\gamma$ 过小时，因为已知 $N-1=2gh$，故分解出 $g$ 是较为容易的。</p>
<p>可以使用 <code>yafu</code> 分解 $\frac{N-1}{2}$，其中当 $\gamma$ 值约为 0.10 左右时分解迅速。</p>
<h2 id="11coppersmith定理攻击">11、coppersmith定理攻击</h2>
<ul>
<li>
<h3 id="基本原理">基本原理</h3>
</li>
</ul>
<h2 id="12e和phi不互素">12、e和phi不互素</h2>
<ul>
<li>
<h3 id="gcdeφn--1">gcd(e,φ(n)) ≠ 1</h3>
</li>
</ul>
</section>

  
  
  <div class="paginator">
    
    
    <a class="next" href="https://p1um3r.github.io/blog/rsa%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/"><span>RSA学习笔记（1）</span>
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375C21.4339 3.93962 21.3581 3.30535 21.1917 2.76787M3.77086 21.1546C1.9934 20.7777 0.973585 18.7264 1.08749 16.688C1.2668 13.479 1.15721 9.43135 1.00513 6.21507C0.87809 3.52811 3.12891 1.16316 5.51029 1.25008C9.76594 1.40542 15.377 1.20229 18.7912 1.00542C20.0864 0.930734 20.8406 1.63385 21.1917 2.76787M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787C23.1097 4.18217 23.13 12.4191 22.9004 16.3608C20.8478 24.0194 12.3061 23.6662 6.5 22.0658M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608C21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966C16.0174 11.8297 16.0154 11.9753 15.9494 12.0063C14.945 12.4779 13.0706 13.9264 12.055 15M15.5556 11.9667C13.1345 12.0608 8 12 6 11" stroke="currentColor" stroke-linecap="round"/>
      </svg>
    </a>
    
  </div>
  

  


  
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
    integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"
    integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js"
    integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
</article>


        </div>
        <div id="fastSearch">
          <input id="searchInput" tabindex="0">
          <ul id="searchResults">
          </ul>
        </div>
        <script src="/js/fuse.js"></script> 
        <script src="/js/fastsearch.js"></script><footer class="footer">
  <p>&copy; 2023 <a href="https://p1um3r.github.io">p1um&#39;s blog</a>
    Powered by
    <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>
    <a href="https://github.com/guangzhengli/hugo-theme-ladder" rel="noopener" target="_blank">Ladder</a>
️  </p>
</footer>

<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211C22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257M21.7387 7.71865C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257C17.1684 -1.24629 7.83127 0.632493 4.27577 5.04257C2.88063 6.77451 -0.0433281 11.1668 1.38159 16.6571C2.27481 20.0988 5.17269 22.2936 8.19743 22.7725M20.7188 5.04257C22.0697 6.9404 24.0299 11.3848 22.3541 15.4153M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814C11.1703 6.98257 11.0247 6.98456 10.9937 7.05061C10.5221 8.05496 9.07362 9.92941 8 10.945M11.0333 7.44444C10.9392 9.86549 11 15 12 17" stroke="currentColor" stroke-linecap="round"/>
    </svg>
</a>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>

<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Copied';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });
        codeblock.parentNode.appendChild(copybutton);
    });
</script></main>
    </body>
  
  <script src="/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js" integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin="anonymous" defer></script></html>
